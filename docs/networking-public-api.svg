<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="481px" preserveAspectRatio="none" style="width:1195px;height:481px;background:#FEFEFE;" version="1.1" viewBox="0 0 1195 481" width="1195px" zoomAndPan="magnify"><defs><filter height="300%" id="f17916ax2s6xq6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="206" x="492" y="28.708">Customer API Dataflow</text><rect fill="#DDDDDD" height="434.9141" style="stroke:#A80036;stroke-width:1.0;" width="1048" x="141" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="600" y="53.02">cloud.redhat.com</text><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="200.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171.5" y="212.2109"/><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="155.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="403" y="256.4766"/><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="102.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="300.7422"/><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1044" y="345.0078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="88" x2="88" y1="111.6797" y2="421.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="176" x2="176" y1="111.6797" y2="421.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="408" x2="408" y1="111.6797" y2="421.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="755" x2="755" y1="111.6797" y2="421.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1049" x2="1049" y1="111.6797" y2="421.2734"/><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="71" x="51" y="76.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="58" y="96.3779">Browser</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="71" x="51" y="420.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="58" y="440.2686">Browser</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="145" y="76.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="152" y="96.3779">3scale</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="145" y="420.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="152" y="440.2686">3scale</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="376" x="218" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="241" x="285.5" y="80.0811">rhsm-subscriptions API k8s Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="362" x="225" y="96.3779">(e.g. rhsm-subscriptions.rhsm-prod.svc.cluster.local)</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="376" x="218" y="420.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="241" x="285.5" y="440.2686">rhsm-subscriptions API k8s Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="362" x="225" y="456.5654">(e.g. rhsm-subscriptions.rhsm-prod.svc.cluster.local)</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="291" x="608" y="76.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277" x="615" y="96.3779">rhsm-subscriptions API Deployment Pod</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="291" x="608" y="420.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="277" x="615" y="440.2686">rhsm-subscriptions API Deployment Pod</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="268" x="913" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="235" x="929.5" y="80.0811">console.redhat.com RBAC Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="254" x="920" y="96.3779">(e.g. rbac.rbac-prod.svc.cluster.local)</text><rect fill="#FEFECE" filter="url(#f17916ax2s6xq6)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="268" x="913" y="420.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="235" x="929.5" y="440.2686">console.redhat.com RBAC Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="254" x="920" y="456.5654">(e.g. rbac.rbac-prod.svc.cluster.local)</text><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="200.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171.5" y="212.2109"/><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="155.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="403" y="256.4766"/><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="102.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="300.7422"/><rect fill="#FFFFFF" filter="url(#f17916ax2s6xq6)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1044" y="345.0078"/><path d="M5,126.6797 L5,166.6797 L1134,166.6797 L1134,136.6797 L1124,126.6797 L5,126.6797 " fill="#FBFB77" filter="url(#f17916ax2s6xq6)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1124,126.6797 L1124,136.6797 L1134,136.6797 L1124,126.6797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="329.5" y="143.7466">Example endpoint:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="467" x="329.5" y="158.8794">https://console.redhat.com/api/rhsm-subscriptions/v1/tally/products/RHEL</text><polygon fill="#A80036" points="159.5,208.2109,169.5,212.2109,159.5,216.2109,163.5,212.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="165.5" y1="212.2109" y2="212.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="95.5" y="192.0122">https</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="95.5" y="207.145">(port 443)</text><polygon fill="#A80036" points="391,252.4766,401,256.4766,391,260.4766,395,256.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="181.5" x2="397" y1="256.4766" y2="256.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="188.5" y="236.2778">http w/ x-rh-identity header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="188.5" y="251.4106">(port 8000)</text><polygon fill="#A80036" points="738.5,296.7422,748.5,300.7422,738.5,304.7422,742.5,300.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="413" x2="744.5" y1="300.7422" y2="300.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="420" y="280.5435">http w/ x-rh-identity header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="420" y="295.6763">(port 8000)</text><polygon fill="#A80036" points="1032,341.0078,1042,345.0078,1032,349.0078,1036,345.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="760.5" x2="1038" y1="345.0078" y2="345.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="767.5" y="324.8091">authorization check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="767.5" y="339.9419">(port 8080)</text><polygon fill="#A80036" points="771.5,370.1406,761.5,374.1406,771.5,378.1406,767.5,374.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="765.5" x2="1048" y1="374.1406" y2="374.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="777.5" y="369.0747">permissions JSON</text><polygon fill="#A80036" points="99.5,399.2734,89.5,403.2734,99.5,407.2734,95.5,403.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="93.5" x2="754.5" y1="403.2734" y2="403.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="105.5" y="398.2075">Response JSON</text><!--MD5=[251c7062408908285733b7eef7651316]
@startuml

' see https://forum.plantuml.net/8356/white-backgrounds-are-rendered-transparent-in-svg
skinparam backgroundColor #FEFEFE

title Customer API Dataflow

autoactivate on
participant Browser

box cloud.redhat.com
participant 3scale
participant service as "rhsm-subscriptions API k8s Service\n(e.g. rhsm-subscriptions.rhsm-prod.svc.cluster.local)"
participant api as "rhsm-subscriptions API Deployment Pod"
participant rbac as "console.redhat.com RBAC Service\n(e.g. rbac.rbac-prod.svc.cluster.local)"
end box

note across: Example endpoint:\nhttps://console.redhat.com/api/rhsm-subscriptions/v1/tally/products/RHEL

Browser -> 3scale: https\n(port 443)

3scale -> service: http w/ x-rh-identity header\n(port 8000)

service -> api: http w/ x-rh-identity header \n(port 8000)

api -> rbac: authorization check\n(port 8080)

return permissions JSON

api - -> Browser: Response JSON

@enduml

@startuml

skinparam backgroundColor #FEFEFE

title Customer API Dataflow

autoactivate on
participant Browser

box cloud.redhat.com
participant 3scale
participant service as "rhsm-subscriptions API k8s Service\n(e.g. rhsm-subscriptions.rhsm-prod.svc.cluster.local)"
participant api as "rhsm-subscriptions API Deployment Pod"
participant rbac as "console.redhat.com RBAC Service\n(e.g. rbac.rbac-prod.svc.cluster.local)"
end box

note across: Example endpoint:\nhttps://console.redhat.com/api/rhsm-subscriptions/v1/tally/products/RHEL

Browser -> 3scale: https\n(port 443)

3scale -> service: http w/ x-rh-identity header\n(port 8000)

service -> api: http w/ x-rh-identity header \n(port 8000)

api -> rbac: authorization check\n(port 8080)

return permissions JSON

api - -> Browser: Response JSON

@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 UTC 2021)
(LGPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>